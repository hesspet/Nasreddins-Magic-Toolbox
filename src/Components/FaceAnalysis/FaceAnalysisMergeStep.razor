@using Toolbox.Models

<div class="face-analysis-step">
    <div class="face-analysis-step__card">
        <header class="face-analysis-step__header">
            <h2>Schritt 4: Merge Ergebnis</h2>
            <p>Überprüfen Sie das kombinierte Bild und gehen Sie bei Bedarf zurück.</p>
        </header>

        <section class="face-analysis-merge">
            @if (CanMerge)
            {
                <FaceAnalysisCardOverlay PhotoImageBytes="PhotoImageBytes"
                                          PhotoContentType="PhotoContentType"
                                          AnalysisResult="AnalysisResult"
                                          CardImageBytes="CardImageBytes"
                                          CardDescription="CardDescription" />
            }
            else
            {
                <p class="face-analysis-merge__placeholder">Es sind nicht genügend Daten vorhanden, um ein Bild zu erstellen.</p>
            }
        </section>

        <footer class="face-analysis-step__footer">
            <div class="face-analysis-step__actions">
                <MagicButton Variant="MagicButtonVariant.Secondary"
                             Title="Zum vorherigen Schritt"
                             AriaLabel="Zum vorherigen Schritt"
                             OnClick="OnBack">
                    <StartIcon>
                        <fluent-icon class="fluent-icon--button" name="arrow-left-24-regular"></fluent-icon>
                    </StartIcon>
                    <ChildContent>
                        <span>Zurück</span>
                    </ChildContent>
                </MagicButton>
                <MagicButton Variant="MagicButtonVariant.Ghost"
                             Title="Workflow neu starten"
                             AriaLabel="Workflow neu starten"
                             OnClick="OnRestart">
                    <StartIcon>
                        <fluent-icon class="fluent-icon--button" name="arrow-counterclockwise-24-regular"></fluent-icon>
                    </StartIcon>
                    <ChildContent>
                        <span>Restart</span>
                    </ChildContent>
                </MagicButton>
            </div>
        </footer>
    </div>
</div>

@code {
    [Parameter]
    public EventCallback OnBack
    {
        get; set;
    }

    [Parameter]
    public EventCallback OnRestart
    {
        get; set;
    }

    [Parameter]
    public FaceAnalysisResult? AnalysisResult
    {
        get; set;
    }

    [Parameter]
    public byte[]? PhotoImageBytes
    {
        get; set;
    }

    [Parameter]
    public string? PhotoContentType
    {
        get; set;
    }

    [Parameter]
    public byte[]? CardImageBytes
    {
        get; set;
    }

    [Parameter]
    public string? CardDescription
    {
        get; set;
    }

    private bool CanMerge => PhotoImageBytes is not null
                              && CardImageBytes is not null
                              && AnalysisResult?.Nose is not null
                              && !string.IsNullOrWhiteSpace(PhotoContentType);
}
