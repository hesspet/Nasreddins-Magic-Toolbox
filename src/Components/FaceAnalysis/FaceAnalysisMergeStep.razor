@using Toolbox.Models

<div class="face-analysis-step">
    <div class="face-analysis-step__card">
        <header class="face-analysis-step__header">
            <h2>Schritt 4: Merge Ergebnis</h2>
            <p>Überprüfen Sie das kombinierte Bild und gehen Sie bei Bedarf zurück.</p>
        </header>

        <section class="face-analysis-merge">
            @if (CanMerge)
            {
                <FaceAnalysisCardOverlay PhotoImageBytes="PhotoImageBytes"
                                          PhotoContentType="PhotoContentType"
                                          AnalysisResult="AnalysisResult"
                                          CardImageBytes="CardImageBytes"
                                          CardDescription="CardDescription" />
            }
            else
            {
                <p class="face-analysis-merge__placeholder">Es sind nicht genügend Daten vorhanden, um ein Bild zu erstellen.</p>
            }
        </section>

        <footer class="face-analysis-step__footer">
            <div class="face-analysis-step__actions">
                <button type="button"
                        class="fluent-button fluent-button--secondary"
                        title="Zum vorherigen Schritt"
                        aria-label="Zum vorherigen Schritt"
                        @onclick="OnBack">
                    <span class="fluent-button__icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" role="img" focusable="false">
                            <path d="M13 3.5a1 1 0 0 1 0 2H8.41l3.3 3.29a1 1 0 0 1-1.32 1.5l-.1-.08-4.5-4.5a1 1 0 0 1 0-1.42l4.5-4.5a1 1 0 0 1 1.5 1.32l-.08.1L8.4 3.5H13Z"
                                  fill="currentColor" />
                        </svg>
                    </span>
                    <span>Zurück</span>
                </button>
                <button type="button"
                        class="fluent-button fluent-button--ghost"
                        title="Workflow neu starten"
                        aria-label="Workflow neu starten"
                        @onclick="OnRestart">
                    <span class="fluent-button__icon" aria-hidden="true">
                        <svg viewBox="0 0 24 24" role="img" focusable="false">
                            <path d="M20.5 4.75a.75.75 0 0 1 .75.75v4a.75.75 0 0 1-1.5 0V7.56l-.22.22a8 8 0 1 1-5.65-2.34.75.75 0 1 1 0 1.5 6.5 6.5 0 1 0 4.6 1.9l-.23-.22V9.5a.75.75 0 0 1-1.5 0v-4a.75.75 0 0 1 .75-.75h3Z"
                                  fill="currentColor" />
                        </svg>
                    </span>
                    <span>Restart</span>
                </button>
            </div>
        </footer>
    </div>
</div>

@code {
    [Parameter]
    public EventCallback OnBack
    {
        get; set;
    }

    [Parameter]
    public EventCallback OnRestart
    {
        get; set;
    }

    [Parameter]
    public FaceAnalysisResult? AnalysisResult
    {
        get; set;
    }

    [Parameter]
    public byte[]? PhotoImageBytes
    {
        get; set;
    }

    [Parameter]
    public string? PhotoContentType
    {
        get; set;
    }

    [Parameter]
    public byte[]? CardImageBytes
    {
        get; set;
    }

    [Parameter]
    public string? CardDescription
    {
        get; set;
    }

    private bool CanMerge => PhotoImageBytes is not null
                              && CardImageBytes is not null
                              && AnalysisResult?.Nose is not null
                              && !string.IsNullOrWhiteSpace(PhotoContentType);
}
