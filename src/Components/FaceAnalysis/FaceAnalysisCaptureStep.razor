<div class="face-analysis-step">
    <div class="face-analysis-step__card">
        <header class="face-analysis-step__header">
            <h2>Schritt 2: Bild erfassen</h2>
            @if (!string.IsNullOrWhiteSpace(CardDisplayName))
            {
                <p>Karte: @CardDisplayName</p>
            }
        </header>

        <section class="face-analysis-capture">
            <CameraStream OnPhotoCaptured="OnPhotoCaptured" />

            @if (!string.IsNullOrWhiteSpace(StatusMessage))
            {
                <p class="face-analysis-capture__status">@StatusMessage</p>
            }

            @if (!string.IsNullOrWhiteSpace(ImageDataUrl))
            {
                <figure class="face-analysis-capture__preview">
                    <img src="@ImageDataUrl" alt="Aufgenommenes Foto" />
                    <figcaption>Bitte prüfen Sie das Bild, bevor Sie die Analyse starten.</figcaption>
                </figure>
            }
            else
            {
                <p class="face-analysis-capture__placeholder">Noch kein Bild vorhanden!</p>
            }
        </section>

        <footer class="face-analysis-step__footer face-analysis-step__footer--split">
            <div class="face-analysis-step__actions">
                <MagicButton Variant="MagicButtonVariant.Secondary"
                             Title="Zum vorherigen Schritt"
                             AriaLabel="Zum vorherigen Schritt"
                             OnClick="OnBack">
                    <StartIcon>
                        <svg viewBox="0 0 24 24" role="img" focusable="false">
                            <path d="M13 3.5a1 1 0 0 1 0 2H8.41l3.3 3.29a1 1 0 0 1-1.32 1.5l-.1-.08-4.5-4.5a1 1 0 0 1 0-1.42l4.5-4.5a1 1 0 0 1 1.5 1.32l-.08.1L8.4 3.5H13Z"
                                  fill="currentColor" />
                        </svg>
                    </StartIcon>
                    <ChildContent>
                        <span>Zurück</span>
                    </ChildContent>
                </MagicButton>
                <MagicButton Variant="MagicButtonVariant.Ghost"
                             Title="Workflow neu starten"
                             AriaLabel="Workflow neu starten"
                             OnClick="OnRestart">
                    <StartIcon>
                        <svg viewBox="0 0 24 24" role="img" focusable="false">
                            <path d="M20.5 4.75a.75.75 0 0 1 .75.75v4a.75.75 0 0 1-1.5 0V7.56l-.22.22a8 8 0 1 1-5.65-2.34.75.75 0 1 1 0 1.5 6.5 6.5 0 1 0 4.6 1.9l-.23-.22V9.5a.75.75 0 0 1-1.5 0v-4a.75.75 0 0 1 .75-.75h3Z"
                                  fill="currentColor" />
                        </svg>
                    </StartIcon>
                    <ChildContent>
                        <span>Restart</span>
                    </ChildContent>
                </MagicButton>
            </div>
            <MagicButton Title="Analyse starten"
                         AriaLabel="Analyse starten"
                         Disabled="@(!IsStartEnabled)"
                         OnClick="OnStartAnalysis"
                         IsLoading="IsAnalyzing"
                         SpinnerSize="MagicButtonSpinnerSize.Small">
                <LoadingContent>
                    <span>Analyse läuft …</span>
                </LoadingContent>
                <StartIcon>
                    <svg viewBox="0 0 24 24" role="img" focusable="false">
                        <path d="M6.75 4.43a1 1 0 0 1 1.5-.86l9 5.57a1 1 0 0 1 0 1.72l-9 5.57a1 1 0 0 1-1.5-.86V4.43Z"
                              fill="currentColor" />
                    </svg>
                </StartIcon>
                <ChildContent>
                    <span>Start Analyse</span>
                </ChildContent>
            </MagicButton>
        </footer>
    </div>
</div>

@code {
    [Parameter]
    public EventCallback OnBack
    {
        get; set;
    }

    [Parameter]
    public EventCallback<string> OnPhotoCaptured
    {
        get; set;
    }

    [Parameter]
    public EventCallback OnStartAnalysis
    {
        get; set;
    }

    [Parameter]
    public EventCallback OnRestart
    {
        get; set;
    }

    [Parameter]
    public string? StatusMessage
    {
        get; set;
    }

    [Parameter]
    public string? ImageDataUrl
    {
        get; set;
    }

    [Parameter]
    public bool IsAnalyzing
    {
        get; set;
    }

    [Parameter]
    public bool IsStartEnabled
    {
        get; set;
    }

    [Parameter]
    public string? CardDisplayName
    {
        get; set;
    }
}
