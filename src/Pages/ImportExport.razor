@page "/import-export"
@using System
@using System.Buffers
@using System.Collections.Generic
@using System.Globalization
@using System.IO
@using System.IO.Compression
@using System.Linq
@using System.Text
@using Microsoft.AspNetCore.Components.Forms
@using Toolbox.Helpers
@using Toolbox.Models
@inject IndexedDbHelper DbHelper

<PageTitle>@DisplayTexts.ImportExportPageTitle</PageTitle>
<h1>@DisplayTexts.ImportExportPageHeader</h1>

<section class="deck-import" aria-labelledby="deck-import-heading">
    <h2 id="deck-import-heading">@DisplayTexts.ImportExportDeckImportHeading</h2>

    <div class="mb-3">
        <label for="deck-upload" class="form-label">@DisplayTexts.ImportExportDeckUploadLabel</label>
        <InputFile id="deck-upload"
                   class="form-control"
                   OnChange="HandleFileSelectedAsync"
                   accept=".zip"
                   disabled="@isImporting" />
        <div class="form-text">@DisplayTexts.ImportExportDeckUploadHint</div>
    </div>

    @if (!string.IsNullOrWhiteSpace(statusMessage))
    {
        <p class="@statusCssClass" role="status">@statusMessage</p>
    }
</section>

@if (showImportLog)
{
    <div class="deck-report-backdrop import-log-backdrop">
        <div class="deck-report-dialog import-log-dialog" role="dialog" aria-modal="true" aria-labelledby="import-log-title">
            <header class="deck-report-header import-log-header">
                <h2 id="import-log-title">@DisplayTexts.ImportExportDeckLogTitle</h2>
                <button type="button"
                        class="btn-close deck-report-close"
                        @onclick="CloseImportLog"
                        aria-label="@DisplayTexts.ImportExportDeckLogCloseButtonLabel"
                        aria-disabled="@isImporting"
                        disabled="@isImporting">
                </button>
            </header>
            <section class="deck-report-body import-log-body">
                <ul class="import-log-list" role="log" aria-live="polite">
                    @foreach (var entry in logEntries)
                    {
                        <li class="import-log-entry">@entry</li>
                    }
                </ul>
                <button type="button"
                        class="btn btn-primary import-log-close-action"
                        @onclick="CloseImportLog"
                        aria-disabled="@isImporting"
                        disabled="@isImporting">
                    @DisplayTexts.ImportExportDeckLogCloseButtonLabel
                </button>
            </section>
        </div>
    </div>
}

@if (showImportReport)
{
    <DeckReport Title="@string.Format(CultureInfo.CurrentCulture, DisplayTexts.ImportExportDeckReportTitleFormat, reportDeckName)"
                Entries="@reportEntries"
                CloseButtonLabel="@DisplayTexts.ImportExportDeckReportCloseButtonLabel"
                CloseButtonAriaLabel="@DisplayTexts.ImportExportDeckReportCloseButtonLabel"
                ImageLengthLabel="@DisplayTexts.ImportExportDeckReportImageLengthLabel"
                DescriptionLengthLabel="@DisplayTexts.ImportExportDeckReportDescriptionLengthLabel"
                OnClose="CloseImportReport" />
}


