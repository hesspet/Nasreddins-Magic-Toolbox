@page "/daten-info"
@using System.Collections.Generic
@using System.Globalization
@using System.Linq
@using Toolbox.Models
@inject IndexedDbHelper DbHelper

<PageTitle>@DisplayTexts.DataInfoPageTitle</PageTitle>
<h1>@DisplayTexts.DataInfoPageHeader</h1>

@if (isLoadingDecks)
{
    <p class="text-muted">@DisplayTexts.DataInfoDeckLoading</p>
}
else if (decks.Count == 0)
{
    <p>@DisplayTexts.DataInfoNoDecksMessage</p>
}
else
{
    <section class="deck-selection" aria-labelledby="deck-selection-heading">
        <h2 id="deck-selection-heading" class="visually-hidden">@DisplayTexts.DataInfoDeckSelectionHeading</h2>
        <div class="mb-3">
            <label for="deck-selection" class="form-label">@DisplayTexts.DataInfoDeckSelectionLabel</label>
            <InputSelect id="deck-selection"
                         class="form-select"
                         @bind-Value="selectedDeckId"
                         disabled="@(isLoadingDecks || isDeletingDeck)">
                @foreach (var deck in decks)
                {
                    <option value="@deck.Id">@deck.Name</option>
                }
            </InputSelect>
        </div>
        <div class="d-flex gap-2 flex-wrap">
            <button type="button"
                    class="btn btn-primary"
                    @onclick="ShowReportAsync"
                    disabled="@(!CanShowReport)">
                @DisplayTexts.DataInfoShowReportButton
            </button>
            <button type="button"
                    class="btn btn-danger"
                    @onclick="DeleteSelectedDeckAsync"
                    disabled="@(!CanDeleteDeck)">
                @DisplayTexts.DataInfoDeleteDeckButton
            </button>
        </div>
    </section>

    @if (isLoadingReport)
    {
        <p class="text-muted mt-3">@DisplayTexts.DataInfoReportLoading</p>
    }
}

@if (showDeleteLog && deleteLogEntries.Count > 0)
{
    <section class="mt-4" aria-labelledby="delete-log-title">
        <h2 id="delete-log-title" class="h5">@DisplayTexts.DataInfoDeleteDeckLogTitle</h2>
        <ul class="list-unstyled mb-0" role="log" aria-live="polite">
            @foreach (var entry in deleteLogEntries)
            {
                <li>@entry</li>
            }
        </ul>
    </section>
}

@if (showReport)
{
    <DeckReport Title="@string.Format(CultureInfo.CurrentCulture, DisplayTexts.DataInfoReportTitleFormat, reportDeckName)"
                Entries="@reportEntries"
                CloseButtonLabel="@DisplayTexts.DataInfoReportCloseButtonLabel"
                CloseButtonAriaLabel="@DisplayTexts.DataInfoReportCloseButtonLabel"
                ImageLengthLabel="@DisplayTexts.ImportExportDeckReportImageLengthLabel"
                DescriptionLengthLabel="@DisplayTexts.ImportExportDeckReportDescriptionLengthLabel"
                OnClose="CloseReport" />
}


